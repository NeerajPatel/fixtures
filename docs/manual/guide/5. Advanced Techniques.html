<html>
     <head>
     	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
     	<title>5. Advanced Techniques</title>
     	<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8">
     </head>
	<body class="body">
		<h1><a name="5. Advanced Techniques">5. Advanced Techniques</a></h1><h2><a name="5.1 Pre & Post Processing">5.1 Pre & Post Processing</a></h2>Sometimes it's necessary to do something before or after your fixture is loaded. You can do this by adding <code>preProcess</code> and/or <code>postProcess</code> handler.<p class="paragraph"/><div class="code"><pre>preProcess &#123;
	/&#42; <span class="java&#45;keyword">do</span> things before loading fixture &#42;/
&#125;
fixture &#123;
	/&#42; fixture definition &#42;/
&#125;<p class="paragraph"/>postProcess &#123;
	/&#42; <span class="java&#45;keyword">do</span> things after loading fixture &#42;/
&#125;</pre></div><p class="paragraph"/>All beans in the application context are available in both pre and post processors...<p class="paragraph"/><div class="code"><pre>preProcess &#123;
	someService.someMethod()
&#125;</pre></div><p class="paragraph"/>Additionally, any object loaded in the fixture is available in the <em class="italic">post</em> processor by name...<p class="paragraph"/><div class="code"><pre>fixture &#123;
	log(LogMessage) &#123;
		message = <span class="java&#45;quote">"something happened"</span>
	&#125;
&#125;
postProcess &#123;
	// change the creation date of the log message
	log.dateCreated &#45;= 1
	log.save()
&#125;</pre></div><p class="paragraph"/>Pre process handlers are executed as soon as they are encountered. However, post processors are <strong class="bold">not</strong> executed until all fixtures have been loaded (e.g load patterns that match multiple files or fixtures with includes).
<h2><a name="5.2 Stacking">5.2 Stacking</a></h2>Fixtures can stack on each other which can be an effective technique for creating complex fixtures out of simpler building blocks. This is best illustrated by an example…<p class="paragraph"/><div class="code"><pre>// fixtures/authors.groovy
fixture &#123;
  guillaume(Author, name: <span class="java&#45;quote">"Guillaume Laforge"</span>)
  dierk(Author, name: <span class="java&#45;quote">"Dierk Koenig"</span>)
&#125;<p class="paragraph"/>// fixtures/books.groovy
fixture &#123;
  gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, authors: &#91;guillaume, dierk&#93;)
&#125;<p class="paragraph"/>fixtureLoader.load(<span class="java&#45;quote">"authors"</span>).load(<span class="java&#45;quote">"books"</span>)</pre></div><p class="paragraph"/>The fixture contained in <code>authors</code> is created and persisted, then the fixture in <code>books</code> is created and persisted independently. Note that the <code>books</code> fixture can refer to any objects loaded in a <em class="italic">parent</em> fixture by name.<p class="paragraph"/>This can also be done with inline fixtures…<p class="paragraph"/><div class="code"><pre>// fixtures/authors.groovy
fixture &#123;
&#125;<p class="paragraph"/>// fixtures/books.groovy
fixture &#123;
  gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, authors: &#91;guillaume, dierk&#93;)
&#125;<p class="paragraph"/>fixtureLoader.load &#123;
  guillaume(Author, name: <span class="java&#45;quote">"Guillaume Laforge"</span>)
  dierk(Author, name: <span class="java&#45;quote">"Dierk Koenig"</span>)  
&#125;.load &#123;
  gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, authors: &#91;guillaume, dierk&#93;)
&#125;</pre></div><p class="paragraph"/>While this is possible, it's not overly useful. What can be useful however is to build on a fixture inline…<p class="paragraph"/><div class="code"><pre>// fixtures/authors.groovy
fixture &#123;
  guillaume(Author, name: <span class="java&#45;quote">"Guillaume Laforge"</span>)
  dierk(Author, name: <span class="java&#45;quote">"Dierk Koenig"</span>)
&#125;<p class="paragraph"/>fixtureLoader.load(<span class="java&#45;quote">"authors"</span>).load &#123;
  gina(Book, title: <span class="java&#45;quote">"Groovy In Action"</span>, authors: &#91;guillaume, dierk&#93;)
&#125;</pre></div><p class="paragraph"/>In a real work scenario, <code>authors</code> could contain common bean definitions that are used across many tests. Using this technique, you can reuse these common definitions and then conveniently augment/extend them in individual tests.<h2><a name="5.3. Includes">5.3. Includes</a></h2>
	</body>
</html>